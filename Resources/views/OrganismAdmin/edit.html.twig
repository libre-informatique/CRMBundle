{#

This file is part of the Sonata package.

(c) Baptiste SIMON <beta@e-glop.net>
(c) Marcos Bezerra de Menezes <marcos.bezerra@libre-informatique.fr>
(c) Libre Informatique [http://www.libre-informatique.fr/]

For the full copyright and license information, please view the LICENSE
file that was distributed with this source code.

#}

{% extends 'LibrinfoCoreBundle:CRUD:base_edit.html.twig' %}

{% block bottom_js %}
    <script>
        $(document).ready(function(){
            var prefix = "{{ form.vars.id }}_";

            // ********** Individual / Collective

            function toggleIndividual(){
                var $individual_1 = $('#' + prefix + 'individual_1');
                if( $individual_1.prop('checked') ) {
                    $individual_1.closest('ul').next('.help-block').show();
                    $('#sonata-ba-field-container-' + prefix + 'title').show();
                    $('#sonata-ba-field-container-' + prefix + 'firstname').show();
                }
                else {
                    $individual_1.closest('ul').next('.help-block').hide();
                    $('#sonata-ba-field-container-' + prefix + 'title').hide();
                    $('#sonata-ba-field-container-' + prefix + 'firstname').hide();
                }
            }

            toggleIndividual();
            $('#' + prefix + 'individual').on('ifChanged', toggleIndividual);

            // ************ Customer Code

            var customer_container = $('#sonata-ba-field-container-' + prefix + 'customer');
            customer_container.wrap('<div class="form-inline">');
            customer_container.find('.sonata-ba-field').css({display: 'inline-block', minWidth: '180px'});
            customer_container.find('label').css('margin-left', '0').css('margin-right', '1em');
            var customer_code_container = $('#sonata-ba-field-container-' + prefix + 'customerCode');
            customer_code_container.find('input').appendTo(customer_container);
            customer_code_container.find('a').appendTo(customer_container);
            customer_code_container.find('label').remove();

            function generateCustomerCode(){
                var $input = $('input#' + prefix + 'customerCode');
                $.get($('#customer-code-generator').attr('href'), function(data){
                    $input.val(data.customer_code);
                });
                return false;
            }

            function toggleCustomerCode(){
                var $code = $('#' + prefix + 'customerCode');
                var $link = $('#' + prefix + 'customerCode_generate_code');
                if( $('#' + prefix + 'customer').prop('checked') ) {
                    $('label[for=' + prefix + 'customerCode').addClass('required');
                    if ($code.data('old') !== undefined)
                        $code.val($code.data('old'));
                    $code.show().prop('required', true);
                    $link.show();
                    if ( $code.val().trim() === "" && {{ form.customerCode.vars.errors|length ? 'false' : 'true' }} )
                        generateCustomerCode();
                }
                else {
                    $('label[for=' + prefix + 'customerCode').removeClass('required');
                    $code.hide().prop('required', false).data('old', $code.val()).val('');
                    $link.hide();
                }
            }

            toggleCustomerCode();
            $('#customer-code-generator').click(generateCustomerCode);
            $('#' + prefix + 'customer').on('ifChanged', toggleCustomerCode);

            // ************ Supplier Code

            var supplier_container = $('#sonata-ba-field-container-' + prefix + 'supplier');
            supplier_container.wrap('<div class="form-inline">');
            supplier_container.find('.sonata-ba-field').css({display: 'inline-block', minWidth: '180px'});
            supplier_container.find('label').css('margin-left', '0').css('margin-right', '1em');
            var supplier_code_container = $('#sonata-ba-field-container-' + prefix + 'supplierCode');
            supplier_code_container.find('input').appendTo(supplier_container);
            supplier_code_container.find('a').appendTo(supplier_container);
            supplier_code_container.find('label').remove();

            function generateSupplierCode(){
                var $input = $('input#' + prefix + 'supplierCode');
                $.get($('#supplier-code-generator').attr('href'), function(data){
                    $input.val(data.supplier_code);
                });
                return false;
            };

            function toggleSupplierCode(){
                var $code = $('#' + prefix + 'supplierCode');
                var $link = $('#' + prefix + 'supplierCode_generate_code');
                if( $('#' + prefix + 'supplier').prop('checked') ) {
                    $('label[for=' + prefix + 'supplierCode').addClass('required');
                    if ($code.data('old') !== undefined)
                        $code.val($code.data('old'));
                    $code.show().prop('required', true);
                    $link.show();
                    if ( $code.val().trim() === "" && {{ form.supplierCode.vars.errors|length ? 'false' : 'true' }} )
                        generateSupplierCode();
                }
                else {
                    $('label[for=' + prefix + 'supplierCode').removeClass('required');
                    $code.hide().prop('required', false).data('old', $code.val()).val('');
                    $link.hide();
                }
            }

            toggleSupplierCode();
            $('#supplier-code-generator').click(generateSupplierCode);
            $('#' + prefix + 'supplier').on('ifChanged', toggleSupplierCode);

        });
    </script>
{% endblock %}
